<?xml version="1.0" encoding="UTF-8"?>
<project name="04_Multiversal_Equality" default="compile" basedir=".">

  <property name="sources.dir" value="src" />
  <property name="scala-source.dir" value="${basedir}/src/main/scala" />
  <property name="target.dir" value="${basedir}/target" />
  <property name="build.dir" value="${target.dir}/classes" />
  <property name="main.class" value="Main" />

  <!-- set dotty.home -->
  <property environment="env" />
  <property name="dotty.home" value="${env.DOTTY_HOME}" />

  <target name="init">
    <fail message="dotc compiler not found">
      <condition><not>
        <available file="${dotty.home}\bin\dotc.bat" />
      </not></condition>
    </fail>
    <path id="dotty.classpath">
      <fileset dir="${dotty.home}/lib" includes="*.jar" />
    </path>
    <path id="build.classpath">
      <path refid="dotty.classpath" />
      <pathelement location="${build.dir}" />
    </path>
    <pathconvert property="scala.sources">
      <fileset dir="${scala-source.dir}/" includes="**/*.scala" />
    </pathconvert>
  </target>

   <macrodef name="dotc" >
       <attribute name="destdir" default="${build.dir}"/>
       <attribute name="sourcepath" default="${scala-source.dir}"/>
       <attribute name="classpath" default="."/>
       <attribute name="deprecation" default="on"/>
       <sequential>
           <exec executable="${dotty.home}\bin\dotc.bat">
               <arg value="-d" />
               <arg value="@{destdir}" />
               <arg value="-sourcepath" />
               <arg value="@{sourcepath}" />
               <arg value="-classpath" />
               <arg value="@{classpath}" />
               <arg value="-deprecation" />
               <arg value="${scala.sources}" />
           </exec>
       </sequential>
   </macrodef>

  <target name="compile" depends="init">
    <mkdir dir="${build.dir}" />
    <dotc destdir="${build.dir}"
          sourcepath="${scala-source.dir}"
          classpath="${build.classpath}"
          deprecation="on">
    </dotc>
  </target>

  <target name="run" depends="compile">
    <java classname="${main.class}">
      <classpath>
        <path refid="build.classpath" />
      </classpath>
    </java>
  </target>

  <target name="clean">
    <delete dir="${target.dir}"/>
  </target>

</project>
